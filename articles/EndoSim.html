<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="EndoSim">
<title>EndoSim • EndoSim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="EndoSim">
<meta property="og:description" content="EndoSim">
<meta property="og:image" content="https://cesaraustralia.github.io/EndoSim/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EndoSim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.5.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/EndoSim.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>EndoSim</h1>
            
      
      
      <div class="d-none name"><code>EndoSim.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cesaraustralia.github.io/EndoSim/">EndoSim</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette will show you how to set up and run a simulation using
EndoSim. The inputs for a simulation can be quite complicated, and may
require a lot of data to properly parameterise. We therefore recommended
using the examples in this vignette if you are running simulations using
already included pest, endosymbiont, and parasitoid species. However,
feel free to experiment with different functions and parameters to
explore how they affect simulation outputs and to familiarise yourself
with the package and its use.</p>
<div class="section level2">
<h2 id="setting-up-simulation-inputs">Setting up simulation inputs<a class="anchor" aria-label="anchor" href="#setting-up-simulation-inputs"></a>
</h2>
<p>The first thing we’ll need to do is set up the simulation inputs. In
order to run a simulation using the EndoSim model, we will need the
following objects:</p>
<div class="section level3">
<h3 id="pest">1. <strong>Pest</strong><a class="anchor" aria-label="anchor" href="#pest"></a>
</h3>
<p>A <code>pest()</code> objects includes all the functions defining the
pest’s population dynamics, including development, fecundity, mortality,
and immigration and emigration. The example pest included in the package
is the green peach aphid, <em>Myzus persicae</em>. We can load this pest
by running the following chunk:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">GPA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">GPA</span></span>
<span><span class="co">#&gt; Pest of the species  Myzus persicae</span></span></code></pre></div>
<p>The functions included for this species are based on extensive
literature on the species’ biology, and so we recommend not changing
these unless you wish to create a new pest object with different
functional responses or parameters.</p>
<p>With a pest species you can easily visualise the various functional
responses by using the generic <code><a href="../reference/plot-methods.html">plot()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">GPA</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/pest-plot-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="crop">2. <strong>Crop</strong><a class="anchor" aria-label="anchor" href="#crop"></a>
</h3>
<p>A <code>crop()</code> object includes the half-time of endosymbiont
plant recovery, sowing, emergence and harvest dates, a function defining
how pest carrying capacity changes based on time after crop emergence,
and the crop density (in m<sup>2</sup>). The example crop included in
the package is canola. However, you may still want to adjust many of the
parameters based on the agronomical context in which you are running
your simulation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Canola</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Canola</span></span>
<span><span class="co">#&gt; Canola  crop sown on  2022-04-05 </span></span>
<span><span class="co">#&gt;  sown at a density of  35  plants per m2</span></span>
<span><span class="co">#&gt;  emerging on  2022-04-10  and harvested on  2022-11-01</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="endosymbiont">3. <strong>Endosymbiont</strong><a class="anchor" aria-label="anchor" href="#endosymbiont"></a>
</h3>
<p>An <code>endosym()</code> object includes the endosymbiont’s fitness
cost and functions defining horizontal transmission rates. However, it
also includes the date of initial introduction to the population and the
number of infected individuals introduced - you may want to adjust these
based on the simulation you’re running. The example endosymbiont
included in the package is <em>Rickettsiella</em>. We can load this pest
by running the following chunk:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Rickettsiella</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Rickettsiella</span></span>
<span><span class="co">#&gt; Endosymbiont of the species  Rickettsiella </span></span>
<span><span class="co">#&gt;  with a fitness cost of  0.5 </span></span>
<span><span class="co">#&gt;  1000  infected individuals introduced on  2022-04-17</span></span></code></pre></div>
<p>In this example, R+ individuals (infected with the endosymbiont) are
timed to release a week following crop emergence.</p>
</div>
<div class="section level3">
<h3 id="parasitoid">4. <strong>Parasitoid</strong><a class="anchor" aria-label="anchor" href="#parasitoid"></a>
</h3>
<p>A <code>parasitoid()</code> objects includes all the functions
defining the parasitoid’s population dynamics and behaviour, including
development, attack rates and handling times, as well as arguments
defining which lifestages of the pest are susceptible to attack, the
date of initial introduction to the population and the number of
individuals introduced - you may want to adjust these based on the
simulation you’re running. The susceptible lifestages might also change
based on the pest you are using. The example parasitoid included in the
package is <em>Diaeretiella rapae</em>, which mainly attacks
2<sup>nd</sup> and 3<sup>rd</sup> instars of <em>Myzus persicae</em>. We
can load this parasitoid by running the following chunk:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">DR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">DR</span></span>
<span><span class="co">#&gt; Parasitoid of the species  Diaeretiella rapae </span></span>
<span><span class="co">#&gt;  attacking pests of the following lifestages:  2 3 </span></span>
<span><span class="co">#&gt;  300  individuals introduced on  2022-04-20</span></span></code></pre></div>
<p>In this example, introduction of parasitoids is timed to occur three
days after the release of R+ aphids.</p>
</div>
<div class="section level3">
<h3 id="conds">5. <strong>conds</strong><a class="anchor" aria-label="anchor" href="#conds"></a>
</h3>
<p>A <code>sim_conds()</code> object defines the length of the
simulation and environmental conditions (rainfall, min, max and mean
temperature) in each daily timestep. An example object, for Aroonda
during the growing season of 2022, is attached as an example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Aroonda</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Aroonda</span><span class="op">@</span><span class="va">sim_length</span></span>
<span><span class="co">#&gt; [1] 214</span></span>
<span></span>
<span><span class="va">Aroonda</span><span class="op">@</span><span class="va">start_date</span></span>
<span><span class="co">#&gt; [1] "2022-04-01"</span></span></code></pre></div>
<p>Note the start date - in this example we begin the simulation prior
to crop sowing and emergence.</p>
<p>The key slot in the <code>sim_conds()</code> object is
<code>env</code>, a dataframe defining the environmental conditions in
each day of the simulations:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># glimpse the environmnetal conditions dataframe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Aroonda</span><span class="op">@</span><span class="va">env</span><span class="op">)</span></span>
<span><span class="co">#&gt;   t Min.Temp Max.Temp Temperature Precipitation</span></span>
<span><span class="co">#&gt; 1 1     16.2     26.9       21.55           0.1</span></span>
<span><span class="co">#&gt; 2 2     13.3     29.1       21.20           0.0</span></span>
<span><span class="co">#&gt; 3 3     15.8     31.7       23.75           0.0</span></span>
<span><span class="co">#&gt; 4 4     16.5     23.1       19.80           7.6</span></span>
<span><span class="co">#&gt; 5 5     14.5     20.2       17.35           4.4</span></span>
<span><span class="co">#&gt; 6 6     15.3     20.8       18.05           0.4</span></span>
<span></span>
<span><span class="co"># plot the conditions throughout the simulations</span></span>
<span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">Aroonda</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/conds-explore-1.png" width="576"></p>
<p>A <code>sim_conds()</code> object can be defined manually, using your
own sourced or simulated environmental data. If you wish to run a
simulation within Australia, the <code><a href="../reference/make_conds.html">make_conds()</a></code> function can
be used to generate a <code>sim_conds()</code> object for any given
locality in Australia. Data are sourced from SILO based on the provided
coordinates and start and end dates. Note that SILO data are
extrapolated from weather stations, and may not be necessarily
representative of microclimatic conditions in your location. If you wish
to use microclimatic data, we suggest using other resources such as the
<a href="https://mrke.github.io/models/MicroClimate-Models" class="external-link">NicheMapR</a>
package.</p>
</div>
<div class="section level3">
<h3 id="init">6. <strong>init</strong><a class="anchor" aria-label="anchor" href="#init"></a>
</h3>
<p>Finally, the <code>initial()</code> object needs to be set up to
define the initial numbers of R+ and R- pests and crops at the start of
the simulations. The <code>Crop</code> slot is very easy to set up -
this is simply a numeric vector of length 3, where the first element is
the proportion of plants uninfected with the endosymbiont (should
usually be 1), the second element is proportion of plants infected with
the endosymbiont (should usually be 0), and third element is the total
number of plants:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crop.init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,</span>
<span>               <span class="fl">0</span>,</span>
<span>               <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>When running the simulation using the <code>EndoSim()</code>
function, it will internally calculate the area of your plot based on
the provided number of plants in the <code>initial()</code> object and
the provided plant density in the <code>Crop()</code> object.</p>
<p>Next, you will need to set up the initial pest population structure,
which is defined using an array. The first dimension of the array
contains four indices and represents the “type” of the pest in each
cohort, <em>i.e.</em> whether it is infected with the endosymbiont or
not, and whether it is apterae or alate (or destined to become one if
the cohort is still nymphal). The second dimension contains two indices
and represents the two variables that are tracked in each cohort: the
number of individuals of each type (N) and the lifestage they are in
(ranging from 1 to 5, which for <em>Myzus persicae</em> represents four
instars and the adult stage). The third dimension represents the cohort
number.</p>
<p>The initial array needs to be set up with 5 indices in the third
dimension, <em>i.e.</em> with the following dimensions:
<code>c(4, 2, 5)</code>. This way, each cohort represents a different
lifestage, and the initial array represents the numbers of aphids in
each life stage. Here is an example of how to set up an initial
population of 5 aphids of each instar and 80 adults, without any
infected individuals and with an alate proportion of 20%:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create empty array:</span></span>
<span><span class="va">pest.init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>,</span>
<span>                 dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                 dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"pest_type"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pos_apt"</span>, <span class="st">"neg_apt"</span>, <span class="st">"pos_ala"</span>, <span class="st">"neg_ala"</span><span class="op">)</span>,</span>
<span>                                 <span class="st">"variable"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"N"</span>, <span class="st">"lifestage"</span><span class="op">)</span>,</span>
<span>                                 <span class="st">"cohort_num"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                 <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># populate cohorts:</span></span>
<span><span class="va">pest.init</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>                           <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pest.init</span><span class="op">[</span>, , <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>                           <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                         ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pest.init</span><span class="op">[</span>, , <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>                           <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                         ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pest.init</span><span class="op">[</span>, , <span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">4</span>, <span class="fl">0</span>, <span class="fl">1</span>,</span>
<span>                           <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                         ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">pest.init</span><span class="op">[</span>, , <span class="fl">5</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">64</span>, <span class="fl">0</span>, <span class="fl">16</span>,</span>
<span>                           <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                         ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine to create an initial object</span></span>
<span><span class="va">init</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span><span class="st">"initial"</span>,</span>
<span>            Pest <span class="op">=</span> <span class="va">pest.init</span>,</span>
<span>            Crop <span class="op">=</span> <span class="va">crop.init</span><span class="op">)</span></span></code></pre></div>
<p>You may want to experiment widely with different initial population
sizes, since they can have a large impact on the simulation output. If
your simulation begins before crop emergence (as the one in this
vignette does) we suggest setting an initial population size of 0
aphids, since without emerged crops there should be nothing to feed
on:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># change all N values to 0</span></span>
<span><span class="va">init</span><span class="op">@</span><span class="va">Pest</span><span class="op">[</span>, <span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span></code></pre></div>
<p>Don’t worry - the model includes a low immigration rate prior to crop
emergence even if the immigration module is turned off, to represent
incoming aphids from nearby green bridges or crops. This means that your
simulation won’t die off prior to crop emergence, when carrying capacity
begins to increase in the crop and aphid populations can establish.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-a-simulation">Running a simulation<a class="anchor" aria-label="anchor" href="#running-a-simulation"></a>
</h2>
<p>Now that we’ve set up all of our input objects, we can run a
simulation. For this example we will turn off immigration and
emigration, but allow vertical and horizontal transmission of the
endosymbiont, as well as the parasitoid module. This is done using
logical arguments in the function. Note we will also set
<code>plot = TRUE</code> so that the generic plot showing the pest
population dynamics is generated.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/endosim.html">endosim</a></span><span class="op">(</span>Pest <span class="op">=</span> <span class="va">GPA</span>,</span>
<span>                 Endosymbiont <span class="op">=</span> <span class="va">Rickettsiella</span>,</span>
<span>                 Crop <span class="op">=</span> <span class="va">Canola</span>,</span>
<span>                 Parasitoid <span class="op">=</span> <span class="va">DR</span>,</span>
<span>                 init <span class="op">=</span> <span class="va">init</span>,</span>
<span>                 conds <span class="op">=</span> <span class="va">Aroonda</span>,</span>
<span>                 plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 imi <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 emi <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                 vert_trans <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 hori_trans <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                 para <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in endosim(Pest = GPA, Endosymbiont = Rickettsiella, Crop = Canola, :</span></span>
<span><span class="co">#&gt; Immigration cancelled!</span></span>
<span><span class="co">#&gt; Warning in endosim(Pest = GPA, Endosymbiont = Rickettsiella, Crop = Canola, :</span></span>
<span><span class="co">#&gt; Emigration cancelled!</span></span>
<span><span class="co">#&gt; [1] "Population died out at time 160; simulation ended"</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/sim-1.png" width="576"></p>
<div class="section level3">
<h3 id="examining-results">Examining results<a class="anchor" aria-label="anchor" href="#examining-results"></a>
</h3>
<p>We have several handy helper functions to explore the results of a
simulation. First, we can print the model and use a
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function to view some simple summary data about
the simulation, including the mean daily number of aphids, the maximal
number at any time during the simulation and the date when the maximum
was reached, as well as the simulation length and end date (especially
useful if the simulation died out before reaching the pre-determined end
date):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span>
<span><span class="co">#&gt; Endosymbiont model simulation</span></span>
<span><span class="co">#&gt;  Pest:  Myzus persicae </span></span>
<span><span class="co">#&gt;  Crop:  Canola </span></span>
<span><span class="co">#&gt;  Endosymbiont:  Rickettsiella </span></span>
<span><span class="co">#&gt;  Parasitoid:  Diaeretiella rapae </span></span>
<span><span class="co">#&gt;  Started on  2022-04-01 , running for  214  days</span></span>
<span><span class="co">#&gt;  With the following modules:  Vertical transmission, Horizontal transmission, Parasitoid</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt;   mean_aphid aphid_peak  peak_date sim_length   end_date</span></span>
<span><span class="co">#&gt; 1   12.64839       3708 2022-04-26        160 2022-09-08</span></span></code></pre></div>
<p>Besides the default plot showing the population dynamics of R+ and R-
aphids, we have additional plotting options to explore the model more in
depth. This is done by changing the <code>type</code> argument of the
<code><a href="../reference/plot-methods.html">plot()</a></code> function.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">"R+"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Returning more (or less) than 1 row per `summarise()` group was deprecated in</span></span>
<span><span class="co">#&gt; dplyr 1.1.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `reframe()` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> When switching from `summarise()` to `reframe()`, remember that `reframe()`</span></span>
<span><span class="co">#&gt;   always returns an ungrouped data frame and adjust accordingly.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">EndoSim</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue to the authors.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Warning: Removed 2 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/sim-plot-1-1.png" width="576"></p>
<p>This plot shows us the proportion of R+ individuals in the simulation
at any given time. This is useful if we want to track how well the
endosymbiont infection spreads. We can see that in this example, after
the initial introduction, there is initially a sharp decrease in
<em>Rickettsiella</em> prevalence in the population, but this is quickly
counteracted and the infection actually achieves fixation before the
population collapses.</p>
<p>We may also want to explore the aphid demographics more in depth:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">"demo"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/sim-plot-2-1.png" width="576"></p>
<p>This plot shows us the proportions of aphids of different lifestages
in the population at any given time. We can see there are large
fluctuations in the proportion - while the proportion of adults
generally decreases (which is what also leads to the final population
collpase), there is a fluctation between periods of many 2<sup>nd</sup>
and 3<sup>rd</sup> stars and periods of a majority of 1<sup>st</sup>
instars.</p>
<p>To see why, we can explore the final plot type, of the parasitoid
demographics:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">"para"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/sim-plot-3-1.png" width="576"></p>
<p>We can see here that the demographic fluctations match really well
with the parasitoid populations, which makes sense - <em>Diaeretiella
rapae</em> targets 2<sup>nd</sup> and 3<sup>rd</sup> instars of
<em>Myzus persicae</em> and so they quickly disappear whenever a new
cohort of adult wasps emerges. This leaves mostly the 1<sup>st</sup>
instar aphids, and the population never grows fast enough for many
aphids to reach adulthood, at least partly due to the reduced fitness
caused by the <em>Rickettsiella</em> infection. This leads to the final
population collapse we see at the end of the simulation.</p>
<p>Note that in this plot we also see the expected population trend in
parasitoid populations - many mummies are generated once wasps are
released or emerge. Their number steadily drops due to mortality, before
a massive spike due to emergence of a new cohort of wasps. This
continues rhythmically until the end of the simulation.</p>
</div>
</div>
<div class="section level2">
<h2 id="comparing-scenarios">Comparing scenarios<a class="anchor" aria-label="anchor" href="#comparing-scenarios"></a>
</h2>
<p>The final functionality we will explore in this vignette is how to
compare multiple scenarios with different modules. This is done using
the <code><a href="../reference/counterfact.html">counterfact()</a></code> function, which allows for the definition
of counterfactual simulations using a series of logical arguments.</p>
<p>In this example, we will still keep immigration and emigration
switched off, but will explore the impact of turning on or off the two
transmission modules and the parasitism module. This is how the function
is set up:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/counterfact.html">counterfact</a></span><span class="op">(</span>Pest <span class="op">=</span> <span class="va">GPA</span>,</span>
<span>                         Endosymbiont <span class="op">=</span> <span class="va">Rickettsiella</span>,</span>
<span>                         Crop <span class="op">=</span> <span class="va">Canola</span>,</span>
<span>                         Parasitoid <span class="op">=</span> <span class="va">DR</span>,</span>
<span>                         init <span class="op">=</span> <span class="va">init</span>,</span>
<span>                         conds <span class="op">=</span> <span class="va">Aroonda</span>,</span>
<span>                         modules <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>vert_trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                        hori_trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                                        imi <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                        emi <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                        para <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">FALSE</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Running 8 counterfactual simulations"</span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; ================================================================[1] "Population died out at time 171; simulation ended"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; =================================================================[1] "Population died out at time 175; simulation ended"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; ================================================================================</span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; ============================================================[1] "Population died out at time 160; simulation ended"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; =====================================================[1] "Population died out at time 142; simulation ended"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [1] "Running simulation:"</span></span>
<span><span class="co">#&gt; ============================================================[1] "Population died out at time 160; simulation ended"</span></span></code></pre></div>
<p>We can then use the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function to compare our
simple model outputs between the different scenarios:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_all</span><span class="op">)</span></span>
<span><span class="co">#&gt;   vert_trans hori_trans   imi   emi  para mean_aphid aphid_peak  peak_date</span></span>
<span><span class="co">#&gt; 1      FALSE      FALSE FALSE FALSE FALSE   69.39395      24433 2022-10-03</span></span>
<span><span class="co">#&gt; 2       TRUE      FALSE FALSE FALSE FALSE   15.78442       4142 2022-06-08</span></span>
<span><span class="co">#&gt; 3      FALSE       TRUE FALSE FALSE FALSE   16.99423       4400 2022-06-19</span></span>
<span><span class="co">#&gt; 4       TRUE       TRUE FALSE FALSE FALSE   15.04699       4217 2022-06-08</span></span>
<span><span class="co">#&gt; 5      FALSE      FALSE FALSE FALSE  TRUE   33.96842      11696 2022-08-05</span></span>
<span><span class="co">#&gt; 6       TRUE      FALSE FALSE FALSE  TRUE   14.02106       3849 2022-04-26</span></span>
<span><span class="co">#&gt; 7      FALSE       TRUE FALSE FALSE  TRUE   17.39503       4141 2022-04-23</span></span>
<span><span class="co">#&gt; 8       TRUE       TRUE FALSE FALSE  TRUE   12.64839       3708 2022-04-26</span></span>
<span><span class="co">#&gt;   sim_length   end_date</span></span>
<span><span class="co">#&gt; 1        214 2022-11-01</span></span>
<span><span class="co">#&gt; 2        171 2022-09-19</span></span>
<span><span class="co">#&gt; 3        214 2022-11-01</span></span>
<span><span class="co">#&gt; 4        175 2022-09-23</span></span>
<span><span class="co">#&gt; 5        214 2022-11-01</span></span>
<span><span class="co">#&gt; 6        160 2022-09-08</span></span>
<span><span class="co">#&gt; 7        142 2022-08-21</span></span>
<span><span class="co">#&gt; 8        160 2022-09-08</span></span></code></pre></div>
<p>Or, if we want to compare the total population trajectories to see
how the aphid populations fare under the different modelled scenarios,
we can plot a summary figure:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model_all</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/counter-plot-1.png" width="576"></p>
<p>Finally, if we want to explore individual models as we did above, we
can do that easily by just extracting them from the
<code>endosim_col()</code> object:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># from the summary table, we can see that model no. 1 includes no transmission or parasitoids:</span></span>
<span><span class="va">model_all</span><span class="op">@</span><span class="va">sims</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; Endosymbiont model simulation</span></span>
<span><span class="co">#&gt;  Pest:  Myzus persicae </span></span>
<span><span class="co">#&gt;  Crop:  Canola </span></span>
<span><span class="co">#&gt;  Endosymbiont:  Rickettsiella </span></span>
<span><span class="co">#&gt;  Parasitoid:  Diaeretiella rapae </span></span>
<span><span class="co">#&gt;  Started on  2022-04-01 , running for  214  days</span></span>
<span><span class="co">#&gt;  With the following modules:</span></span>
<span></span>
<span><span class="co"># aphid populations</span></span>
<span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model_all</span><span class="op">@</span><span class="va">sims</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/counter-explore-1-1.png" width="576"></p>
<p>We see that in this “baseline” model, the population actually
persists throughout the simulation. As expected with no transmission or
parasitoid modules, the <em>Rickettsiella</em> infection rapidly
disappears from the population, the aphid demographics are a lot more
balanced, and there are no parasitoids or mummies:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># infection dynamics</span></span>
<span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model_all</span><span class="op">@</span><span class="va">sims</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"R+"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/counter-explore-2-1.png" width="576"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># demographics</span></span>
<span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model_all</span><span class="op">@</span><span class="va">sims</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"demo"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/counter-explore-2-2.png" width="576"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># parasitoids</span></span>
<span><span class="fu"><a href="../reference/plot-methods.html">plot</a></span><span class="op">(</span><span class="va">model_all</span><span class="op">@</span><span class="va">sims</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, type <span class="op">=</span> <span class="st">"para"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EndoSim_files/figure-html/counter-explore-2-3.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alex Slavenko.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
